{"version":3,"sources":["components/articlecard/ArticleCard.tsx","components/articlelist/ArticleList.tsx","api/forms.ts","api/collins.ts","components/definition/add.svg","components/definition/Definition.tsx","components/dictionary/arrow-up.svg","components/dictionary/arrow-down.svg","components/dictionary/close.svg","components/dictionary/loading.gif","api/card.ts","components/dictionary/Dictionary.tsx","components/myreader/Myreader.tsx","components/myreader/testdata.ts","types/types.ts","components/myreaderwithdictionary/Myreaderwithdictionary.tsx","utils/tags.tsx","components/wordcard/link.svg","components/wordcard/WordCard.tsx","utils/index.ts","api/export.ts","components/readerpopup/ReaderPopup.tsx","components/cardlist/CardList.tsx","views/cardlist/CardListView.tsx","components/booklist/Booklist.tsx","components/homebanner/HomeBanner.tsx","views/main/MainView.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["NewsCard","title","imgUrl","summary","clickHandler","className","onClick","src","dangerouslySetInnerHTML","__html","ArticleList","useState","newsList","setNewsList","params","useParams","useEffect","a","fetch","id","then","r","json","j","articleList","result","history","useHistory","filter","length","map","item","index","image","excerpt","articleJson","push","encodeURIComponent","formsData","hwdsMap","forms","init","getBaseForms","word","formsArr","toLowerCase","CDN_PREFIX","stripSpanTag","html","replace","trim","getCDNUrl","dir","slice","getHWDListToBeSearched","has","collins","search","Promise","w","all","nestedResult","resultForOneEntry","definition","headword","phrase","hwd","phonetics","shortDefinition","def_cn","entry","def_en","Set","Definition","onAdd","add","CARD_LIST_KEY","cardList","JSON","parse","localStorage","getItem","c","undefined","exported","saveCardList","setItem","stringify","card","cList","Dictionary","sentence","articleId","wordIndex","onClose","console","log","definitionList","setDefinitionList","displayMode","setDisplayMode","isLoading","setIsLoading","message","setMessage","loadDefiniton","iconRow","arrowDown","arrowUp","close","loading","d","i","def","Date","now","toString","originalWord","wordTileIndex","dictResult","addTime","toast","success","isEmptyString","str","isSentenceEnd","trimmed","endsWith","isParagraphEnd","token","t","parentElement","child","lastElementChild","getComputedStyle","display","toMarkable","container","document","querySelector","containerClone","cloneNode","TOKEN_CLASS","text","ele","createElement","innerHTML","classList","match","getTokenType","toTokenSpan","node","nodeValue","nodeType","Array","from","childNodes","forEach","n","nodeName","contains","isTokenSpan","split","before","remove","querySelectorAll","bindEvent","tokenListRef","onWordSelection","tokenList","current","e","target","closest","selectedToken","selectedTokenIndex","indexOf","left","right","startIndex","endIndex","formatedSentence","join","getSentence","textContent","positions","start","end","addEventListener","removeEventListener","Myreader","highlights","readerRef","useRef","firstElementChild","hl","ref","TOKEN_TYPE","Myreaderwithdictionary","articleHtml","setArticleHtml","setHighlights","wordSelection","setWordSelection","decodeURIComponent","content","useCallback","event","concat","type","bracketToBoldTag","maskWord","maskBold","substring","WordCard","defaultState","onShowContextPopup","cardState","setCardState","toggleHide","classObject","cardClass","Boolean","Object","entries","k","link","stopPropagation","Filesystem","Plugins","Share","exportApkg","fileName","deckName","apkg","AnkiExport","addCard","resolve","reject","save","zip","Capacitor","getPlatform","reader","FileReader","onloadend","base64data","writeFile","path","data","directory","FilesystemDirectory","Documents","readAsDataURL","fileStream","streamSaver","createWriteStream","size","writableStrategy","readableStrategy","Response","body","pipeTo","err","ReaderPopup","CardList","detect","exportedCards","filterCardListByType","cardFilter","newCardList","includes","setCardList","showContextPopup","setPopupArticleId","setPopupWordIndex","setCardFilter","cardOptions","popupArticleId","popupWordIndex","value","onChange","key","CardListView","Booklist","bookList","setBookList","book","coverUrl","HomeBanner","MainView","App","exact","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.c62e2f03.chunk.js","sourcesContent":["import \"./ArticleCard.css\";\n\nexport default function NewsCard({\n  title,\n  imgUrl,\n  summary,\n  clickHandler,\n}: {\n  title: string;\n  imgUrl?: string;\n  summary: string;\n  clickHandler: () => void;\n}) {\n  return (\n    <div className=\"article-item\" onClick={clickHandler}>\n      {imgUrl ? (\n        <div className=\"img-wrapper\">\n          <img src={imgUrl} className=\"img\" />\n        </div>\n      ) : null}\n      <div className=\"title\" dangerouslySetInnerHTML={{ __html: title }}></div>\n      <div\n        className=\"description\"\n        dangerouslySetInnerHTML={{ __html: summary }}\n      ></div>\n    </div>\n  );\n}\n","import \"./ArticleList.css\";\nimport { useEffect, useState } from \"react\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport ArticleCard from \"../../components/articlecard/ArticleCard\";\nimport { ArticleItem, ArticleItemNew } from \"../../types/types\";\n\nconst bookJsonUrl = (id: string) => `/calibre/${id}/book.json`;\n\nexport default function ArticleList() {\n  const [newsList, setNewsList] = useState<ArticleItemNew[]>([]);\n  const params = useParams<{ id: string }>();\n\n  useEffect(() => {\n    (async () => {\n      const result: ArticleItemNew[] = await fetch(bookJsonUrl(params.id))\n        .then((r) => r.json())\n        .then((j) => j.articleList);\n      setNewsList(result);\n    })();\n  }, [params]);\n\n  const history = useHistory();\n\n  function handleClick(id: string) {\n    history.push(`/article/${encodeURIComponent(id)}`);\n  }\n\n  return (\n    <div className=\"article-list\">\n      {newsList\n        .filter((a) => a.length > 200)\n        .map((item, index) => (\n          <ArticleCard\n            title={item.title}\n            imgUrl={item.image}\n            summary={item.excerpt}\n            key={index}\n            clickHandler={() => handleClick(item.articleJson)}\n          ></ArticleCard>\n        ))}\n    </div>\n  );\n}\n","let formsData: { [key: string]: string[] };\n\nexport const forms = {\n  async init() {\n    if (!formsData) {\n      formsData = await fetch(\n        \"https://cdn.jsdelivr.net/gh/mmjang/dict_hub@main/hub/forms.map.json\"\n      ).then((r) => r.json());\n    }\n  },\n  async getBaseForms(word: string): Promise<string[]> {\n    await forms.init();\n    const formsArr = formsData[word.toLowerCase()];\n    return formsArr || [];\n  },\n};\n","import { DictResultEntry } from \"../types/types\";\nimport { forms } from \"./forms\";\n\ninterface CollinsEntry {\n  def_cn: string;\n  def_en: string;\n  display_hwd: string;\n  ext: string;\n  hwd: string;\n  phonetics: string;\n  phrase: string;\n  sense: string;\n}\n\nlet hwdsMap: any;\n\nconst CDN_PREFIX = \"https://cdn.jsdelivr.net/gh/mmjang/dict_hub@main\";\n\nfunction stripSpanTag(html: string) {\n  return html\n    .replace(/\\r|\\t|\\n/g, \"\")\n    .replace(/^<span.+?>(.*?)<\\/span>$/, \"$1\")\n    .trim();\n}\n\nfunction getDefinitionFromEntry(entry: CollinsEntry) {\n  return stripSpanTag(entry.def_cn) + \" \" + stripSpanTag(entry.def_en);\n}\n\nfunction getCDNUrl(word: string): string {\n  if (word.length <= 2) {\n    return `${CDN_PREFIX}/hub/collins/${word}.json`;\n  } else {\n    const dir = word.slice(0, 2);\n    return `${CDN_PREFIX}/hub/collins/_${dir}/${word}.json`;\n  }\n}\n\nasync function getHWDListToBeSearched(word: string): Promise<string[]> {\n  const formsArr = await forms.getBaseForms(word.toLowerCase());\n  const result = [word.toLowerCase(), ...formsArr].filter((r) =>\n    hwdsMap.has(r)\n  );\n  return result;\n}\n\nexport const collins = {\n  async search(word: string): Promise<DictResultEntry[]> {\n    await this.init();\n    if (!hwdsMap) {\n      throw \"柯林斯还未初始化\";\n    }\n    const result = [];\n    const nestedResult = (await Promise.all(\n      (await getHWDListToBeSearched(word)).map((w) => {\n        return fetch(getCDNUrl(w)).then((r) => r.json());\n      })\n    )) as CollinsEntry[][];\n    for (const resultForOneEntry of nestedResult) {\n      for (const definition of resultForOneEntry) {\n        result.push(definition);\n      }\n    }\n    return result.map((item) => ({\n      headword: item.phrase ? item.phrase : item.hwd,\n      phonetics: item.phonetics,\n      shortDefinition: stripSpanTag(item.def_cn),\n      definition: getDefinitionFromEntry(item),\n    }));\n  },\n  async init() {\n    await forms.init();\n    if (!hwdsMap) {\n      hwdsMap = new Set(\n        await fetch(CDN_PREFIX + \"/hub/collins.list.json\").then((r) => r.json())\n      );\n    }\n    return true;\n  },\n};\n","export default __webpack_public_path__ + \"static/media/add.9074dc48.svg\";","import { DictResultEntry } from \"../../types/types\";\nimport \"./Definition.css\";\nimport add from \"./add.svg\";\n\nexport default function Definition({\n  headword,\n  phonetics,\n  definition,\n  onAdd,\n}: DictResultEntry & { onAdd: () => void }) {\n  return (\n    <div className=\"definition\">\n      <div className=\"hwd-row\">\n        <img src={add} onClick={onAdd} />\n        <b>{headword}</b>\n      </div>\n      <p dangerouslySetInnerHTML={{ __html: definition }}></p>\n    </div>\n  );\n}\n","export default __webpack_public_path__ + \"static/media/arrow-up.1ba202ef.svg\";","export default __webpack_public_path__ + \"static/media/arrow-down.200220c5.svg\";","export default __webpack_public_path__ + \"static/media/close.53c9f4b6.svg\";","export default __webpack_public_path__ + \"static/media/loading.2ce5c7c5.gif\";","import { Card } from \"../types/types\";\n\nconst CARD_LIST_KEY = \"card_list_key_v2\";\n\nlet cardList: Card[] = JSON.parse(localStorage.getItem(CARD_LIST_KEY) || \"[]\");\n\n// 初始化exported属性，最早的版本没这个\nfor (const c of cardList) {\n  if (c.exported === undefined) {\n    c.exported = false;\n  }\n}\n\nfunction saveCardList() {\n  localStorage.setItem(CARD_LIST_KEY, JSON.stringify(cardList, null, 2));\n}\n\nexport const card = {\n  getCardList() {\n    return cardList;\n  },\n  setCardList(cList: Card[]) {\n    cardList = cList;\n    saveCardList();\n  },\n  addCard(card: Card) {\n    cardList.push(card);\n    saveCardList();\n  },\n  deleteCard(id: string) {\n    const index = cardList.findIndex((card) => card.id === id);\n    if (~index) {\n      cardList.splice(index, 1);\n      saveCardList();\n    } else {\n      throw new Error(`card with id ${id} not exist.`);\n    }\n  },\n  findCard(id: string) {\n    return cardList.find((card) => card.id === id);\n  },\n  modifyCard(id: string, card: Card) {\n    const index = cardList.findIndex((card) => card.id === id);\n    if (~index) {\n      cardList[index] = card;\n      saveCardList();\n    } else {\n      throw new Error(`card with id ${id} not exist.`);\n    }\n  },\n};\n","import { useEffect, useState } from \"react\";\nimport { collins } from \"../../api/collins\";\nimport { DictResultEntry } from \"../../types/types\";\nimport Definition from \"../definition/Definition\";\nimport \"./Dictionary.css\";\nimport arrowUp from \"./arrow-up.svg\";\nimport arrowDown from \"./arrow-down.svg\";\nimport close from \"./close.svg\";\nimport loading from \"./loading.gif\";\nimport { card } from \"../../api/card\";\nimport WordTile from \"../wordtile/WordTile\";\nimport toast from \"react-hot-toast\";\n\ninterface Props {\n  word: string;\n  sentence?: string;\n  articleId: string;\n  wordIndex: number;\n  onClose: () => void;\n}\n\ntype DisplayMode = \"compact\" | \"full\";\n\nexport default function Dictionary({\n  word,\n  sentence = \"\",\n  articleId,\n  wordIndex,\n  onClose,\n}: Props) {\n  console.log(\"rerender\");\n  const [definitionList, setDefinitionList] = useState<DictResultEntry[]>([]);\n  const [displayMode, setDisplayMode] = useState<DisplayMode>(\"compact\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [message, setMessage] = useState(\"\");\n  useEffect(() => {\n    async function loadDefiniton() {\n      try {\n        setIsLoading(true);\n        setMessage(\"\");\n        const result = await collins.search(word);\n        setDefinitionList(result);\n        if (result.length === 0) {\n          setMessage(\"没查到这个词.\");\n        }\n      } catch {\n        setMessage(\"网络错误.\");\n      } finally {\n        setIsLoading(false);\n      }\n    }\n    loadDefiniton();\n  }, [word]);\n\n  function addDefinition(def: DictResultEntry): void {\n    card.addCard({\n      id: Date.now().toString(),\n      originalWord: word,\n      sentence,\n      articleId,\n      wordTileIndex: wordIndex,\n      dictResult: def,\n      addTime: Date.now(),\n    });\n    toast.success(\"添加成功\");\n  }\n\n  const iconRow = (\n    <div\n      className=\"icon-row\"\n      onClick={() =>\n        setDisplayMode(displayMode === \"full\" ? \"compact\" : \"full\")\n      }\n    >\n      <img\n        src={displayMode === \"full\" ? arrowDown : arrowUp}\n        className=\"expand-icon\"\n      />\n      <img src={close} className=\"close-icon\" onClick={onClose} />\n    </div>\n  );\n  if (isLoading) {\n    return (\n      <div className=\"dictionary\">\n        {iconRow}\n        <div className=\"loading\">\n          <img src={loading} />\n        </div>\n      </div>\n    );\n  }\n  if (displayMode === \"full\") {\n    return (\n      <div className=\"dictionary\">\n        {iconRow}\n        <div className=\"message\">{message}</div>\n        {definitionList.map((d, i) => (\n          <div key={i} className=\"definition-wrapper\">\n            <Definition {...d} onAdd={() => addDefinition(d)}></Definition>\n          </div>\n        ))}\n      </div>\n    );\n  } else {\n    return (\n      <div className=\"dictionary compact\">\n        {iconRow}\n        <div className=\"message\">{message}</div>\n        {definitionList.map((d, i) => (\n          <span key={i} className=\"tag\">\n            {d.shortDefinition}\n          </span>\n        ))}\n      </div>\n    );\n  }\n}\n","import { start } from \"node:repl\";\nimport React, { useEffect, useRef } from \"react\";\nimport \"./Myreader.css\";\nimport { TEST_HTML } from \"./testdata\";\n\ntype TokenType = \"word\" | \"blank\" | \"punctuation\";\n\nfunction getTokenType(text: string): TokenType {\n  if (isEmptyString(text)) {\n    return \"blank\";\n  } else if (text.match(/[a-z]+/)) {\n    return \"word\";\n  } else {\n    return \"punctuation\";\n  }\n}\n\nfunction isEmptyString(str: string) {\n  return str.replace(/\\\\n|\\\\t/g, \"\").trim() === \"\";\n}\n\nfunction isSentenceEnd(str: string) {\n  const trimmed = str.trim();\n  return (\n    trimmed.endsWith(\".\") ||\n    trimmed.endsWith(\"?\") ||\n    trimmed.endsWith(\"!\") ||\n    trimmed.endsWith('.\"') ||\n    trimmed.endsWith('?\"') ||\n    trimmed.endsWith('!\"')\n  );\n}\n\nfunction isParagraphEnd(token: Element): boolean {\n  let t = token;\n  while (t.parentElement) {\n    let child = t;\n    t = t.parentElement;\n    if (t.lastElementChild === child) {\n      if (getComputedStyle(t).display === \"block\") {\n        return true;\n      }\n    } else {\n      return false;\n    }\n  }\n  return false;\n}\n\n// markable\nfunction toMarkable(container: Element) {\n  if (document.querySelector(\".token-class\")) {\n    return container;\n  }\n  const containerClone = container.cloneNode(true);\n  const TOKEN_CLASS = \"token-class\";\n  function isTokenSpan(node: Element) {\n    return node.nodeName === \"SPAN\" && node.classList.contains(TOKEN_CLASS);\n  }\n  function token(text: string) {\n    const ele = document.createElement(\"span\");\n    ele.innerHTML = text;\n    ele.classList.add(TOKEN_CLASS);\n    ele.classList.add(getTokenType(text));\n    return ele;\n  }\n  function toTokenSpan(node: Element) {\n    if (!node) {\n      return;\n    }\n    let index = 0;\n    // textnode\n    const nodeValue = node.nodeValue || \"\";\n    if (node.nodeType === 3 && !isEmptyString(nodeValue)) {\n      nodeValue.split(/\\b/).forEach((t) => {\n        return node.before(token(t));\n      });\n      node.remove();\n    } else if (node.nodeType === 1) {\n      Array.from((node as Node).childNodes).forEach((n) => {\n        if (!isTokenSpan(n as Element)) {\n          toTokenSpan(n as Element);\n        }\n      });\n    }\n  }\n  const tokenized = toTokenSpan(containerClone as Element);\n  container.before(containerClone);\n  container.remove();\n  const tokenList = Array.from(document.querySelectorAll(\".token-class\"));\n  for (const token of tokenList) {\n    if (isParagraphEnd(token)) {\n      token.classList.add(\"para-end\");\n    }\n  }\n  return containerClone;\n  // containerClone.addEventListener(\"click\", (e) => {\n  //   alert(e?.target);\n  // });\n}\n\nfunction bindEvent(\n  container: HTMLDivElement,\n  tokenListRef: React.MutableRefObject<Element[]>,\n  onWordSelection: ((event: WordSelectionEvent) => void) | undefined\n) {\n  const tokenList = Array.from(document.querySelectorAll(\".token-class\"));\n  tokenListRef.current = tokenList;\n\n  const onClick = (e: MouseEvent) => {\n    const token = (e.target as Element).closest(\".token-class\");\n    if (token) {\n      const sentence = getSentence(tokenList, token);\n      console.log(sentence);\n      if (sentence && onWordSelection) {\n        onWordSelection({\n          word: {\n            text: token.textContent || \"\",\n            positions: [sentence.wordIndex],\n          },\n          sentence: {\n            text: sentence.formatedSentence,\n            positions: [\n              {\n                start: sentence.startIndex,\n                end: sentence.endIndex,\n              },\n            ],\n          },\n        });\n      }\n    }\n  };\n\n  container.addEventListener(\"click\", onClick);\n\n  return () => {\n    console.log(\"unbind reader click listeners.\");\n    container.removeEventListener(\"click\", onClick);\n  };\n}\n\nfunction getSentence(\n  tokenList: Element[],\n  selectedToken: Element\n): {\n  startIndex: number;\n  endIndex: number;\n  wordIndex: number;\n  formatedSentence: string; // The [[selected]] word is this\n} | null {\n  const selectedTokenIndex = tokenList.indexOf(selectedToken);\n  if (selectedTokenIndex < 0) {\n    return null;\n  } else {\n    let maxLength = 100;\n    let left = selectedTokenIndex;\n    while (left >= 0) {\n      left--;\n      if (\n        tokenList[left].classList.contains(\"para-end\") ||\n        isSentenceEnd(tokenList[left].innerHTML)\n      ) {\n        break;\n      }\n    }\n    left++;\n    let right = selectedTokenIndex;\n    while (right < tokenList.length) {\n      if (\n        tokenList[right].classList.contains(\"para-end\") ||\n        isSentenceEnd(tokenList[right].innerHTML)\n      ) {\n        break;\n      }\n      right++;\n    }\n    right++;\n    return {\n      startIndex: left,\n      endIndex: right,\n      wordIndex: selectedTokenIndex,\n      formatedSentence: tokenList\n        .slice(left, right)\n        .map((token, index) => {\n          if (index + left === selectedTokenIndex) {\n            return `[[${token.innerHTML}]]`;\n          } else {\n            return token.innerHTML;\n          }\n        })\n        .join(\"\"),\n    };\n  }\n}\n\nexport interface Highlight {\n  start: number;\n  end: number;\n  type: \"sentence\" | \"word\";\n}\n\nexport interface WordSelectionEvent {\n  word: {\n    text: string;\n    positions: number[];\n  };\n  sentence: {\n    text: string;\n    positions: {\n      start: number;\n      end: number;\n    }[];\n  };\n}\n/**\n * 此组件的作用是渲染一段html并提供划词功能，主要有：\n * 1. 点击单词，触发划词事件，传递被划单词+所在句子\n * 2. 若传递已选单词id，首次渲染时定位到此单词，并高亮\n * 3. 传入的html不限制具体形式，但是可假设为常见的网页文章\n *    主体部分，可事先通过mozilla readability库预处理得到\n */\n\nexport default function Myreader({\n  html = TEST_HTML,\n  highlights = [],\n  onWordSelection,\n}: {\n  html?: string;\n  highlights?: Highlight[];\n  setHighlights?: (hls: Highlight[]) => void;\n  onWordSelection?: (event: WordSelectionEvent) => void;\n}) {\n  const readerRef = useRef<HTMLDivElement>(null);\n  const tokenListRef = useRef<Element[]>([]);\n\n  // 绑定事件\n  useEffect(() => {\n    if (readerRef.current) {\n      toMarkable(readerRef.current.firstElementChild as Element) as HTMLElement;\n      return bindEvent(\n        readerRef.current.firstElementChild as HTMLDivElement,\n        tokenListRef,\n        onWordSelection\n      );\n    }\n  }, [highlights]);\n\n  // 设置高亮\n  useEffect(() => {\n    for (const token of tokenListRef.current) {\n      token.classList.remove(\"highlight\");\n    }\n\n    for (const hl of highlights) {\n      if (tokenListRef.current.length > 0) {\n        for (let i = hl.start; i < hl.end; i++) {\n          tokenListRef.current[i].classList.add(\"highlight\");\n        }\n      }\n    }\n  }, [highlights]);\n\n  // useEffect(() => {\n  //   throw \"阅读器的html内容不支持动态改变！！！\";\n  // }, [html]);\n\n  return (\n    <div ref={readerRef} className=\"myreader\">\n      <div\n        dangerouslySetInnerHTML={{\n          __html: html,\n        }}\n      ></div>\n    </div>\n  );\n}\n","export const TEST_HTML = `\n<article class=\"ssrcss-xalfp3-ArticleWrapper e1nh2i2l6\"><header class=\"ssrcss-18mgjmu-HeadingWrapper e1nh2i2l5\"><h1 tabindex=\"-1\" id=\"main-heading\" class=\"ssrcss-1lgj0ki-StyledHeading e1fj1fc10\">Who are the Taliban?</h1><div><dl class=\"ssrcss-7m91jz-MetadataStrip e1ojgjhb2\"><div class=\"ssrcss-8d0yke-MetadataStripItem e1ojgjhb1\"><dt class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">Published</dt><dd class=\"ssrcss-m5j4pi-MetadataContent e1ojgjhb0\"><span class=\"ssrcss-8g95ls-MetadataSnippet ecn1o5v2\"><time data-testid=\"timestamp\" datetime=\"2021-08-15T10:57:15.000Z\"><span data-testid=\"time-and-date:clock\" class=\"ssrcss-1cyelkp-IconContainer ecn1o5v0\"><svg viewBox=\"0 0 32 32\" width=\"1em\" height=\"1em\" class=\"ssrcss-xi5oyi-StyledIcon e6m7o991\" focusable=\"false\" aria-hidden=\"true\"><path d=\"M16 31c8.5 0 15-6.5 15-15S24.5 1 16 1 1 7.5 1 16s6.5 15 15 15zm0-2.7C9 28.3 3.7 23 3.7 16S9 3.7 16 3.7C23 3.7 28.3 9 28.3 16S23 28.3 16 28.3zm6.2-6.7l1-1.5-5.7-4.5-.6-8.6H15l-.7 10.5 7.9 4.1z\"></path></svg></span>1 day ago</time></span></dd></div></dl></div><div class=\"ssrcss-xa24e7-TagShareWrapper e1nh2i2l0\"><div class=\"ssrcss-1ynay8h-StyledInformationPanel e15ad6a64\"><div><button width=\"content-length\" type=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"ssrcss-d4g1xj-Button etotop31\"><span data-testid=\"actions:share\" class=\"ssrcss-1a1fy59-IconWrapper etotop30\"><svg viewBox=\"0 0 32 32\" width=\"1em\" height=\"1em\" class=\"ssrcss-xi5oyi-StyledIcon e6m7o991\" focusable=\"false\" aria-hidden=\"true\"><path d=\"M7.8 17L25.3 7l-1.2-2.3L6.6 15l1.2 2zm-1.2 0l17.5 10.3 1.2-2.3L7.8 15l-1.2 2zm5.6-1c0-2.7-2.2-5-5-5-2.7 0-4.9 2.2-4.9 5 0 2.7 2.2 4.9 4.9 4.9 2.8 0 5-2.2 5-4.9zM29.7 5.9c0-2.7-2.2-5-5-5-2.7 0-4.9 2.2-4.9 5 0 2.7 2.2 4.9 4.9 4.9 2.8 0 5-2.2 5-4.9zm0 20.2c0-2.7-2.2-5-5-5-2.7 0-4.9 2.2-4.9 5 0 2.7 2.2 4.9 4.9 4.9 2.8.1 5-2.2 5-4.9z\"></path></svg><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">Share</span></span></button></div><div hidden=\"\" role=\"group\" aria-labelledby=\"share-tools-panel\" class=\"ssrcss-1gzwa2x-StyledPanelContent e15ad6a63\"><div class=\"ssrcss-1u4rjjc-CloseButtonWrapper e15ad6a61\"><button width=\"content-length\" type=\"button\" class=\"ssrcss-11dapvy-Button etotop31\"><span data-testid=\"actions:close\" class=\"ssrcss-1a1fy59-IconWrapper etotop30\"><svg viewBox=\"0 0 32 32\" width=\"1em\" height=\"1em\" class=\"ssrcss-xi5oyi-StyledIcon e6m7o991\" focusable=\"false\" aria-hidden=\"true\"><path d=\"M30 4.6l-2.8-2.8L2 27.4l2.8 2.8L30 4.6zM4.8 1.8L1.9 4.7l25.2 25.5 2.9-2.9L4.8 1.8z\"></path></svg><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">close</span></span></button></div><div class=\"ssrcss-16sh5ob-PanelWrapper e15ad6a62\"><div id=\"share-tools-panel\" aria-hidden=\"true\" class=\"ssrcss-o2h3ib-StyledTitleArea e15ad6a60\">Share page</div><div><div><button width=\"full\" type=\"button\" aria-label=\"Copy link\" class=\"ssrcss-1bairvc-Button etotop31\"><span data-testid=\"actions:link\" class=\"ssrcss-xwi91l-IconWrapper etotop30\"><svg viewBox=\"0 0 32 32\" width=\"1em\" height=\"1em\" class=\"ssrcss-xi5oyi-StyledIcon e6m7o991\" focusable=\"false\" aria-hidden=\"true\"><path d=\"M20.7 9.5l-11 11.1 1.8 1.8 11.1-11.1-1.9-1.8zm.6 6.3l-2 2c2.1 1.4 5.9.8 8.7-2l.6-.6c3-3 3.9-7.6-.1-11.7-4-4-8.6-3-11.6 0l-.6.5c-3 3-3.5 6.7-2 8.7l2-2c-.3-1.1-.2-2.7 2-4.9l.6-.6c2.4-2.4 5.4-2.5 7.9 0 2.5 2.6 2.4 5.5 0 7.9l-.6.6c-2.2 2.3-3.9 2.4-4.9 2.1zm-5.5 5.5c.3 1 .2 2.7-2 4.8l-.6.6c-2.4 2.4-5.4 2.5-7.9 0s-2.4-5.5 0-7.9l.6-.6c2.1-2.1 3.8-2.3 4.9-2l2-2c-2-1.4-5.7-.9-8.7 2l-.6.6c-3 3-4 7.6 0 11.6s8.6 3.1 11.7.1l.6-.6c2.9-2.9 3.5-6.7 2-8.7l-2 2.1z\"></path></svg></span>Copy link</button></div></div><a href=\"https://www.bbc.co.uk/usingthebbc/terms/can-i-share-things-from-the-bbc\" class=\"ssrcss-gs1xzq-StyledLink ezys19s0\">About sharing</a></div></div></div></div></header><div data-component=\"image-block\" class=\"ssrcss-vk3nhx-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-tm19a7-Placeholder e16icw910\"><span><img alt=\"Afghan Taliban fighters and villagers attend a gathering as they celebrate the peace deal signed between US and Taliban in Laghman Province, Alingar district on March 2, 2020.\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg\" width=\"976\" height=\"650\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"Afghan Taliban fighters and villagers attend a gathering as they celebrate the peace deal signed between US and Taliban in Laghman Province, Alingar district on March 2, 2020.\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/10546/production/_119168866_gettyimages-1204741868.jpg\" width=\"976\" height=\"650\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span><span class=\"ssrcss-1ecljvk-StyledFigureCopyright e34k3c20\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image source</span>Getty Images</span></div><figcaption class=\"ssrcss-1rnnz6t-StyledFigureCaption e34k3c22\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image caption</span>Taliban fighters in Laghman Province in March 2020. The group is resurgent as the US leaves</figcaption></figure></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\"><b class=\"ssrcss-hmf8ql-BoldText e5tfeyi3\">The Taliban were removed from power in Afghanistan by US-led forces in 2001, but the group has been on the offensive in recent months and is now on the brink of seizing power again.</b></p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">As the US prepared to complete its withdrawal by 11 September, after two decades of war, the militants took major cities and have now reached the outskirts of the capital Kabul.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The group entered direct talks with the US back in 2018, and in February 2020 the two sides struck a peace deal in Doha that committed the US to withdrawal and the Taliban to preventing attacks on US forces. Other promises included not allowing al-Qaeda or other militants to operate in areas it controlled and proceeding with national peace talks.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">But in the year that followed, the Taliban continued to target Afghan security forces and civilians, and advanced rapidly across the country.</p></div></div><div data-component=\"crosshead-block\" class=\"ssrcss-mysbf6-ComponentWrapper-CrossheadComponentWrapper e1xue1i86\"><h2 class=\"ssrcss-1s5ma9r-StyledHeading e1fj1fc10\">Rise to power</h2></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\" style=\"\">The Taliban, or \"students\" in the Pashto language, emerged in the early 1990s in northern Pakistan following the withdrawal of Soviet troops from Afghanistan. It is believed that the predominantly Pashtun movement first appeared in religious seminaries - mostly paid for by money from Saudi Arabia - which preached a hardline form of Sunni Islam.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The promise made by the Taliban - in Pashtun areas straddling Pakistan and Afghanistan - was to restore peace and security and enforce their own austere version of Sharia, or Islamic law, once in power.</p></div></div><div id=\"piano-inline1\"><div class=\"tp-container-inner\" style=\"height: 234px; width: 359px;\"><iframe id=\"offer_0e763acc7b457c03340a-0\" name=\"offer_0e763acc7b457c03340a-0\" title=\"offer_0e763acc7b457c03340a-0\" scrolling=\"no\" allowtransparency=\"true\" src=\"https://buy.tinypass.com/checkout/template/cacheableShow?aid=tYOkq7qlAI&amp;templateId=OTBYI8Q89QWC&amp;templateVariantId=OTV0YFYSXVQWV&amp;offerId=fakeOfferId&amp;experienceId=EXAWX60BX4NU&amp;iframeId=offer_0e763acc7b457c03340a-0&amp;displayMode=inline&amp;widget=template\" allow=\"payment\" frameborder=\"0\" style=\"overflow: hidden; background-color: transparent; border: 0px; width: 359px; height: 234px;\"></iframe></div></div><div data-component=\"image-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-g565l0-Placeholder e16icw910\"><span><img alt=\"Graphic showing the Taliban leadership structure\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 976w\" src=\"https://ichef.bbci.co.uk/news/1024/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png\" width=\"1024\" height=\"1856\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"Graphic showing the Taliban leadership structure\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png 976w\" src=\"https://ichef.bbci.co.uk/news/1024/cpsprodpb/D9C4/production/_119184755_taliban_leadership_structure_640_2x-nc.png\" width=\"1024\" height=\"1856\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span></div></figure></div><div data-component=\"image-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-1rix78v-Placeholder e16icw910\"><span><img alt=\"1px transparent line\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 976w\" src=\"https://ichef.bbci.co.uk/news/624/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png\" width=\"624\" height=\"1\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"1px transparent line\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png 976w\" src=\"https://ichef.bbci.co.uk/news/624/cpsprodpb/4BEB/production/_112953491__108802839_624_transparent-nc.png\" width=\"624\" height=\"1\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span></div></figure></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">From south-western Afghanistan, the Taliban quickly extended their influence. In September 1995 they captured the province of Herat, bordering Iran, and exactly one year later they captured the Afghan capital, Kabul, overthrowing the regime of President Burhanuddin Rabbani - one of the founding fathers of the Afghan mujahideen that resisted the Soviet occupation. By 1998, the Taliban were in control of almost 90% of Afghanistan.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Afghans, weary of the mujahideen's excesses and infighting after the Soviets were driven out, generally welcomed the Taliban when they first appeared on the scene. Their early popularity was largely due to their success in stamping out corruption, curbing lawlessness and making the roads and the areas under their control safe for commerce to flourish.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">But the Taliban also introduced or supported punishments in line with their strict interpretation of Sharia law - such as public executions of convicted murderers and adulterers, and amputations for those found guilty of theft. Men were required to grow beards and women had to wear the all-covering burka.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The Taliban also banned television, music and cinema, and disapproved of girls aged 10 and over going to school. They were accused of various human rights and cultural abuses. One notorious example was in 2001, when the Taliban went ahead with the <a href=\"https://www.bbc.co.uk/news/world-asia-31813681\" class=\"ssrcss-9nsdc6-InlineLink e1no5rhv0\">destruction of the famous Bamiyan Buddha</a> statues in central Afghanistan, despite international outrage.</p></div></div><div data-component=\"image-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-1hq4gmv-Placeholder e16icw910\"><span><img alt=\"Taliban gumen control Kandahar-Herat Highway, near Kandahar city, 31 October 2001\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"Taliban gumen control Kandahar-Herat Highway, near Kandahar city, 31 October 2001\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/12D1E/production/_119168077_gettyimages-51342654.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span><span class=\"ssrcss-1ecljvk-StyledFigureCopyright e34k3c20\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image source</span>Getty Images</span></div><figcaption class=\"ssrcss-1rnnz6t-StyledFigureCaption e34k3c22\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image caption</span>Taliban gunmen control the Kandahar-Herat highway, near Kandahar city, 31 October 2001</figcaption></figure></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Pakistan has repeatedly denied that it was the architect of the Taliban enterprise, but there is little doubt that many Afghans who initially joined the movement were educated in madrassas (religious schools) in Pakistan.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Pakistan was also one of only three countries, along with Saudi Arabia and the United Arab Emirates (UAE), which recognised the Taliban when they were in power in Afghanistan. It was also the last country to break diplomatic ties with the group.</p></div></div><div id=\"piano-inline2\"></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">At one point, the Taliban threatened to destabilise Pakistan from areas they controlled in the north-west. One of the most high-profile and internationally condemned of all Pakistani Taliban attacks took place in October 2012, when schoolgirl <a href=\"http://www.bbc.co.uk/news/world-asia-19882799\" class=\"ssrcss-9nsdc6-InlineLink e1no5rhv0\">Malala Yousafzai was shot</a> on her way home in the town of Mingora.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">A major military offensive two years later following the <a href=\"https://www.bbc.co.uk/news/world-asia-30505448\" class=\"ssrcss-9nsdc6-InlineLink e1no5rhv0\">Peshawar school massacre</a> greatly reduced the group's influence in Pakistan though. At least three key figures of the Pakistani Taliban had been killed in US drone strikes in 2013, including the group's leader, Hakimullah Mehsud.</p></div></div><div data-component=\"image-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-1hq4gmv-Placeholder e16icw910\"><span><img alt=\"Pakistani schoolgirl Malala Yousafzai was shot by Taliban gunmen in October 2012\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"Pakistani schoolgirl Malala Yousafzai was shot by Taliban gunmen in October 2012\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/B7EE/production/_119168074_gettyimages-994923648.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span><span class=\"ssrcss-1ecljvk-StyledFigureCopyright e34k3c20\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image source</span>Getty Images</span></div><figcaption class=\"ssrcss-1rnnz6t-StyledFigureCaption e34k3c22\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image caption</span>Schoolgirl and rights activist Malala Yousafzai was shot by Taliban gunmen in October 2012</figcaption></figure></div><div data-component=\"crosshead-block\" class=\"ssrcss-mysbf6-ComponentWrapper-CrossheadComponentWrapper e1xue1i86\"><h2 class=\"ssrcss-1s5ma9r-StyledHeading e1fj1fc10\">Al-Qaeda 'sanctuary'</h2></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The attention of the world was drawn to the Taliban in Afghanistan in the wake of the 11 September 2001 World Trade Center attacks in New York. The Taliban were accused of providing a sanctuary for the prime suspects - Osama Bin Laden and his al-Qaeda movement.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">On October 7, 2001, a US-led military coalition launched attacks in Afghanistan, and by the first week of December the Taliban regime had collapsed. The group's then-leader, Mullah Mohammad Omar, and other senior figures, including Bin Laden, evaded capture despite one of the largest manhunts in the world. </p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Many senior Taliban leaders reportedly took refuge in the Pakistani city of Quetta, from where they guided the Taliban. But the existence of what was dubbed the \"Quetta Shura\" was denied by Islamabad.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Despite ever higher numbers of foreign troops, the Taliban gradually regained and then extended their influence in Afghanistan, rendering vast tracts of the country insecure, and violence in the country returned to levels not seen since 2001.</p></div></div><div id=\"piano-inline3\"></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">There were numerous Taliban attacks on Kabul and, in September 2012, the group carried out <a href=\"http://www.bbc.co.uk/news/world-asia-19704620\" class=\"ssrcss-9nsdc6-InlineLink e1no5rhv0\">a high-profile raid on Nato's Camp Bastion base</a>.</p></div></div><div data-component=\"image-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><span class=\"ssrcss-1hq4gmv-Placeholder e16icw910\"><span><img alt=\"Pakistani Taliban commander Hakimullah Mehsud speaks to a group of media representatives in the Mamouzai area\" srcset=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"><noscript><img alt=\"Pakistani Taliban commander Hakimullah Mehsud speaks to a group of media representatives in the Mamouzai area\" srcSet=\"https://ichef.bbci.co.uk/news/240/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 240w, https://ichef.bbci.co.uk/news/320/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 320w, https://ichef.bbci.co.uk/news/480/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 480w, https://ichef.bbci.co.uk/news/624/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 624w, https://ichef.bbci.co.uk/news/800/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 800w, https://ichef.bbci.co.uk/news/976/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg 976w\" src=\"https://ichef.bbci.co.uk/news/976/cpsprodpb/1F96/production/_119168080_gettyimages-95820358.jpg\" width=\"976\" height=\"549\" loading=\"lazy\" class=\"ssrcss-1drmwog-Image ee0ct7c0\"/></noscript></span></span><span class=\"ssrcss-1ecljvk-StyledFigureCopyright e34k3c20\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image source</span>AFP</span></div><figcaption class=\"ssrcss-1rnnz6t-StyledFigureCaption e34k3c22\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">image caption</span>Pakistani Taliban leader Hakimullah Mehsud was killed in a US drone strike in 2013</figcaption></figure></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Hopes of a negotiated peace were raised in 2013, when the Taliban announced plans to open an office in Qatar. But mistrust on all sides remained high and the violence went on.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">In August 2015, the Taliban admitted they had covered up Mullah Omar's death - reportedly of health problems at a hospital in Pakistan - for more than two years. The following month, the group said it had put aside weeks of infighting and rallied around a new leader in the form of Mullah Mansour, who had been the deputy of Mullah Omar.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">At around the same time, the Taliban seized control of a provincial capital for the first time since their defeat in 2001, taking control of the strategically important city of Kunduz.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Mullah Mansour was killed in a US drone strike in May 2016 and replaced by his deputy Mawlawi Hibatullah Akhundzada, who remains in control of the group.</p></div></div><div data-component=\"crosshead-block\" class=\"ssrcss-mysbf6-ComponentWrapper-CrossheadComponentWrapper e1xue1i86\"><h2 class=\"ssrcss-1s5ma9r-StyledHeading e1fj1fc10\">Countdown to withdrawal</h2></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">In the year following the US-Taliban peace deal of February 2020 - which was the culmination of a long spell of direct talks - the Taliban appeared to shift its tactics from complex attacks in cities and on military outposts to a <a href=\"https://www.bbc.co.uk/news/world-asia-56157627\" class=\"ssrcss-9nsdc6-InlineLink e1no5rhv0\">wave of targeted assassinations that terrorised Afghan civilians</a>.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The targets - journalists, judges, peace activists, women in positions of power - appeared to suggest that the Taliban had not changed their extremist ideology, only their strategy. </p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Despite grave concerns from Afghan officials over the government's vulnerability to the Taliban without international support, the new US president, Joe Biden, announced in April 2021 that all American forces would leave the country by 11 September - two decades to the day since the felling of the World Trade Center. </p></div></div><div data-component=\"media-block\" class=\"ssrcss-18mjolk-ComponentWrapper e1xue1i810\"><figure class=\"ssrcss-15m9t32-StyledFigure e34k3c23\"><div class=\"ssrcss-ab5fd8-StyledFigureContainer e34k3c21\"><div class=\"ssrcss-1uy4vn0-Container e1h75hkw2\" id=\"bbcMediaPlayer0\"><div style=\"position:relative;z-index:999;height:100%;width:100%;padding-bottom:56.25%\" id=\"smphtml5iframebbcMediaPlayer0wrp\"><iframe id=\"smphtml5iframebbcMediaPlayer0\" name=\"smphtml5iframebbcMediaPlayer0\" allow=\"autoplay\" frameborder=\"0\" scrolling=\"no\" lang=\"en-GB\" allowfullscreen=\"\" allowtransparency=\"\" style=\"position:absolute;left:0;top:0;width:100%;height:100%\" src=\"//emp.bbc.com/emp/SMPj/2.43.6/iframe.html\" title=\"Hibatullah Akhundzada is a religious scholar and he is former head of the Taliban courts\"></iframe></div></div></div><figcaption class=\"ssrcss-1rnnz6t-StyledFigureCaption e34k3c22\"><span class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">media caption</span>Hibatullah Akhundzada is a religious scholar and he is former head of the Taliban courts</figcaption></figure></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">Having outlasted a superpower through two decades of war, the Taliban began seizing vast swathes of territory, threatening to once again topple a government in Kabul in the wake of a foreign power withdrawing.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The group is thought to now be stronger in numbers than at any point since they were ousted in 2001 - with up to 85,000 full time fighters, according to recent Nato estimates. </p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">The advance has been more rapid than many had feared. General Austin Miller, the commander of the US-led mission in Afghanistan, warned in June that the country could be on a path towards a chaotic civil war, which he called a \"concern for the world\".</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">However, in many cases the Taliban have been able to take over major cities without a fight, as government forces surrendered to avoid civilian casualties.</p></div></div><div data-component=\"text-block\" class=\"ssrcss-uf6wea-RichTextComponentWrapper e1xue1i87\"><div class=\"ssrcss-18snukc-RichTextContainer e5tfeyi1\"><p class=\"ssrcss-1q0x1qg-Paragraph eq5iqo00\">A US intelligence assessment the same month reportedly concluded that the Afghan government could fall within six months of the American military departure.</p></div></div><section data-component=\"tag-list\" class=\"ssrcss-16y9amd-SectionWrapper e1nh2i2l2\"><div class=\"ssrcss-1p6iqi-StyledTagContainer ed0g1kj1\"><div class=\"ssrcss-4c4zzp-SectionHeaderWrapper e1nh2i2l3\"><div class=\"ssrcss-1y8kwfd-SectionHeader eik4du50\"><h2 class=\"ssrcss-1n5grds-StyledHeading e1fj1fc10\">Related Topics</h2></div></div><div class=\"ssrcss-i7uuy0-Cluster e1ihwmse1\"><ul role=\"list\" spacing=\"2\" class=\"ssrcss-d7aixc-ClusterItems e1ihwmse0\"><li><a href=\"/news/topics/c8nq32jw5r5t\" class=\"ssrcss-1yno9a1-StyledLink ed0g1kj0\">Afghanistan</a></li><li><a href=\"/news/topics/ckgj731eel1t\" class=\"ssrcss-1yno9a1-StyledLink ed0g1kj0\">Taliban</a></li><li><a href=\"/news/topics/c008ql15vpyt\" class=\"ssrcss-1yno9a1-StyledLink ed0g1kj0\">Pakistan</a></li></ul></div></div></section><section data-component=\"see-alsos\" class=\"ssrcss-16y9amd-SectionWrapper e1nh2i2l2\"><div class=\"ssrcss-4c4zzp-SectionHeaderWrapper e1nh2i2l3\"><div class=\"ssrcss-1y8kwfd-SectionHeader eik4du50\"><h2 class=\"ssrcss-1n5grds-StyledHeading e1fj1fc10\">More on this story</h2></div></div><ul role=\"list\" spacing=\"responsive\" class=\"ssrcss-v19xcd-Stack e1y4nx260\"><li class=\"ssrcss-1as76fj-PromoItem e1nh2i2l4\"><div class=\"ssrcss-10kr542-Promo ett16tt0\"><div class=\"ssrcss-1wok6t6-PromoNoImage e98n9a20\"><div class=\"ssrcss-som5se-PromoContent e1f5wbog7\"><div spacing=\"2\" class=\"ssrcss-1cbga70-Stack e1y4nx260\"><a href=\"/news/world-asia-56741106\" class=\"ssrcss-fnayaz-PromoLink e1f5wbog0\"><span role=\"text\"><p class=\"ssrcss-nff25b-PromoHeadline e1f5wbog4\"><span aria-hidden=\"false\">Afghans face pivotal moment as US 'closes the book'</span></p></span></a></div><div spacing=\"4\" class=\"ssrcss-1tha3dg-Stack e1y4nx260\"><div><dl class=\"ssrcss-7m91jz-MetadataStrip e1ojgjhb2\"><div class=\"ssrcss-8d0yke-MetadataStripItem e1ojgjhb1\"><dt class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">Published</dt><dd class=\"ssrcss-m5j4pi-MetadataContent e1ojgjhb0\"><span class=\"ssrcss-8g95ls-MetadataSnippet ecn1o5v2\">14 April</span></dd></div></dl></div></div></div></div></div></li><li class=\"ssrcss-1as76fj-PromoItem e1nh2i2l4\"><div class=\"ssrcss-10kr542-Promo ett16tt0\"><div class=\"ssrcss-1wok6t6-PromoNoImage e98n9a20\"><div class=\"ssrcss-som5se-PromoContent e1f5wbog7\"><div spacing=\"2\" class=\"ssrcss-1cbga70-Stack e1y4nx260\"><a href=\"/news/world-asia-56157627\" class=\"ssrcss-fnayaz-PromoLink e1f5wbog0\"><span role=\"text\"><p class=\"ssrcss-nff25b-PromoHeadline e1f5wbog4\"><span aria-hidden=\"false\">A year of violence on the road to peace</span></p></span></a></div><div spacing=\"4\" class=\"ssrcss-1tha3dg-Stack e1y4nx260\"><div><dl class=\"ssrcss-7m91jz-MetadataStrip e1ojgjhb2\"><div class=\"ssrcss-8d0yke-MetadataStripItem e1ojgjhb1\"><dt class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">Published</dt><dd class=\"ssrcss-m5j4pi-MetadataContent e1ojgjhb0\"><span class=\"ssrcss-8g95ls-MetadataSnippet ecn1o5v2\">28 February</span></dd></div></dl></div></div></div></div></div></li><li class=\"ssrcss-1as76fj-PromoItem e1nh2i2l4\"><div class=\"ssrcss-10kr542-Promo ett16tt0\"><div class=\"ssrcss-1wok6t6-PromoNoImage e98n9a20\"><div class=\"ssrcss-som5se-PromoContent e1f5wbog7\"><div spacing=\"2\" class=\"ssrcss-1cbga70-Stack e1y4nx260\"><a href=\"/news/world-us-canada-57608571\" class=\"ssrcss-fnayaz-PromoLink e1f5wbog0\"><span role=\"text\"><p class=\"ssrcss-nff25b-PromoHeadline e1f5wbog4\"><span aria-hidden=\"false\">US to evacuate thousands of Afghan interpreters</span></p></span></a></div><div spacing=\"4\" class=\"ssrcss-1tha3dg-Stack e1y4nx260\"><div><dl class=\"ssrcss-7m91jz-MetadataStrip e1ojgjhb2\"><div class=\"ssrcss-8d0yke-MetadataStripItem e1ojgjhb1\"><dt class=\"ssrcss-1f39n02-VisuallyHidden e1y6uwnp0\">Published</dt><dd class=\"ssrcss-m5j4pi-MetadataContent e1ojgjhb0\"><span class=\"ssrcss-8g95ls-MetadataSnippet ecn1o5v2\">25 June</span></dd></div></dl></div></div></div></div></div></li></ul></section></article>\n`;\n","interface ArticleBlock {\n  type: \"text\" | \"subtitle\" | \"citation\" | \"image\";\n  /**\n   * use markdown notation\n   * *italic* **bold**\n   */\n  content: string;\n}\n\nexport interface Article {\n  articleId: string;\n  title: string;\n  /**\n   * epoch time in mills\n   */\n  publishDate: number;\n  content: ArticleBlock[];\n}\n\nexport interface ArticleItem {\n  title: string;\n  date: string;\n  img: string;\n  description: string;\n  id: string;\n}\n\nexport interface ArticleItemNew {\n  title: string;\n  byline: string;\n  dir: string;\n  length: number;\n  excerpt: string;\n  siteName: string;\n  articleJson: string;\n  image?: string;\n}\n\nexport interface BookItem {\n  id: string;\n  coverUrl: string;\n  title: string;\n}\n\nexport enum TOKEN_TYPE {\n  WORD,\n  BLANK,\n  SYMBOL,\n  EOL,\n}\n\nexport interface Token {\n  word: string;\n  type: TOKEN_TYPE;\n}\n\nexport interface DictResultEntry {\n  headword: string;\n  phonetics?: string;\n  shortDefinition: string;\n  definition: string;\n}\n\nexport interface Card {\n  id: string;\n  originalWord: string;\n  sentence: string;\n  articleId: string;\n  wordTileIndex: number;\n  dictResult: DictResultEntry;\n  // unix time\n  addTime: number;\n  exported?: boolean;\n}\n","import { useState, useCallback, useEffect } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport Dictionary from \"../dictionary/Dictionary\";\nimport Myreader, { Highlight, WordSelectionEvent } from \"../myreader/Myreader\";\nimport \"./Myreaderwithdictionary.css\";\n\nexport default function Myreaderwithdictionary() {\n  const params = useParams<{ id: string }>();\n  const [articleHtml, setArticleHtml] = useState(\"\");\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n  const [wordSelection, setWordSelection] = useState<WordSelectionEvent>();\n\n  useEffect(() => {\n    fetch(decodeURIComponent(params.id))\n      .then((r) => r.json())\n      .then((j) => setArticleHtml(j.content));\n  }, []);\n\n  const onWordSelection = useCallback((event: WordSelectionEvent) => {\n    setWordSelection(event);\n    setHighlights((highlights) => {\n      return highlights.concat([\n        {\n          start: event.word.positions[0],\n          end: event.word.positions[0] + 1,\n          type: \"word\",\n        },\n      ]);\n    });\n  }, []);\n  return (\n    <div>\n      {articleHtml ? (\n        <Myreader\n          html={articleHtml}\n          highlights={highlights}\n          onWordSelection={onWordSelection}\n        ></Myreader>\n      ) : null}\n      {wordSelection ? (\n        <Dictionary\n          word={wordSelection?.word.text}\n          sentence={wordSelection?.sentence.text}\n          articleId={params.id}\n          wordIndex={wordSelection.word.positions[0]}\n          onClose={() => {\n            setWordSelection(undefined);\n          }}\n        ></Dictionary>\n      ) : null}\n    </div>\n  );\n}\n","export function bracketToBoldTag(str: string) {\n  return str.replace(/\\[\\[(.+?)\\]\\]/g, \"<b>$1</b>\");\n}\nexport function maskWord(word: string) {\n  return word.replace(/\\S/g, \"*\");\n}\nexport function maskBold(str: string) {\n  return str.replace(\n    /<b>(.+?)<\\/b>/g,\n    (substring: string, ...args: any[]): string => {\n      return maskWord(args[0]);\n    }\n  );\n}\n","export default __webpack_public_path__ + \"static/media/link.00ac3d86.svg\";","import { useState } from \"react\";\nimport { Card } from \"../../types/types\";\nimport { makeClasses } from \"../../utils\";\nimport { bracketToBoldTag, maskWord, maskBold } from \"../../utils/tags\";\nimport \"./WordCard.css\";\nimport link from \"./link.svg\";\n\ntype State = \"show\" | \"hide\";\n\ntype Props = Card & {\n  defaultState: State;\n  onShowContextPopup: (articleId: string, wordTileIndex: number) => void;\n};\n\nexport default function WordCard({\n  defaultState,\n  id,\n  originalWord,\n  sentence,\n  articleId,\n  wordTileIndex,\n  dictResult,\n  addTime,\n  exported,\n  onShowContextPopup,\n}: Props) {\n  const [cardState, setCardState] = useState(\"hide\");\n  function toggleHide() {\n    setCardState(cardState === \"hide\" ? \"show\" : \"hide\");\n  }\n  const cardClass = makeClasses({\n    \"word-card\": true,\n    exported: Boolean(exported),\n  });\n  if (cardState === \"show\") {\n    return (\n      <div className={cardClass} onClick={toggleHide}>\n        <h3>\n          <img\n            src={link}\n            onClick={(e: React.MouseEvent) => {\n              e.stopPropagation();\n              onShowContextPopup(articleId, wordTileIndex);\n            }}\n          />{\" \"}\n          {dictResult.headword}\n        </h3>\n        <p dangerouslySetInnerHTML={{ __html: dictResult.definition }}></p>\n        <p dangerouslySetInnerHTML={{ __html: bracketToBoldTag(sentence) }}></p>\n      </div>\n    );\n  } else {\n    return (\n      <div className={cardClass} onClick={toggleHide}>\n        <h3>{maskWord(dictResult.headword)}</h3>\n        <p\n          dangerouslySetInnerHTML={{ __html: maskBold(dictResult.definition) }}\n        ></p>\n        <p\n          dangerouslySetInnerHTML={{\n            __html: maskBold(bracketToBoldTag(sentence)),\n          }}\n        ></p>\n      </div>\n    );\n  }\n}\n","import { Token, TOKEN_TYPE } from \"../types/types\";\n\nexport function makeClasses(classObject: { [key: string]: boolean }): string {\n  return Object.entries(classObject)\n    .filter(([k, v]) => v)\n    .map(([k, v]) => k)\n    .join(\" \");\n}\n\nexport function splitWords(text: string): Token[] {\n  const WORD_REG = /^[A-Za-z-]+/;\n  const SYMBOL_REG = /^([^A-Za-z- ])+/;\n  const BLANK_REG = /^\\s+/;\n  const result = [] as Token[];\n  let count = 0;\n  while (text) {\n    let c;\n    if ((c = text.match(WORD_REG))) {\n      result.push({\n        word: c[0],\n        type: TOKEN_TYPE.WORD,\n      });\n      count++;\n    } else if ((c = text.match(BLANK_REG))) {\n      result.push({\n        word: c[0],\n        type: TOKEN_TYPE.BLANK,\n      });\n      count++;\n    } else if ((c = text.match(SYMBOL_REG))) {\n      result.push({\n        word: c[0],\n        type: TOKEN_TYPE.SYMBOL,\n      });\n      count++;\n    }\n    if (c) {\n      text = text.slice(c[0].length);\n    }\n  }\n  return result;\n}\n","// @ts-ignore\nimport AnkiExport from \"anki-apkg-export\";\nimport { Plugins, FilesystemDirectory, Capacitor } from \"@capacitor/core\";\nimport { saveAs } from \"file-saver\";\nimport streamSaver from \"streamsaver\";\nimport toast from \"react-hot-toast\";\nimport { Card } from \"../types/types\";\nimport { bracketToBoldTag } from \"../utils/tags\";\n\nconst { Filesystem, Share } = Plugins;\n\nexport async function exportApkg(\n  cardList: Card[],\n  fileName: string,\n  deckName = \"duck-reader\"\n) {\n  const apkg = new AnkiExport(deckName);\n\n  for (const entry of cardList) {\n    apkg.addCard(\n      `<h3>${entry.dictResult.headword}</h3>\n         <p>${bracketToBoldTag(entry.sentence)}</p>\n        `,\n      `\n         <p>${entry.dictResult.phonetics}</p>\n         <p>${entry.dictResult.definition}</p>\n        `\n    );\n  }\n\n  return new Promise((resolve, reject) => {\n    apkg.save().then((zip: any) => {\n      if (Capacitor.getPlatform() === \"android\") {\n        var reader = new FileReader();\n        reader.onloadend = async () => {\n          var base64data = reader.result;\n          try {\n            const result = await Filesystem.writeFile({\n              path: fileName,\n              data: base64data as string,\n              directory: FilesystemDirectory.Documents,\n            });\n            resolve(result);\n          } catch (err) {\n            reject(err);\n          }\n        };\n        reader.readAsDataURL(zip);\n      } else {\n        try {\n          // debugger;\n          // saveAs(zip, fileName);\n          // resolve(true);\n          const fileStream = streamSaver.createWriteStream(fileName, {\n            size: undefined, // (optional filesize) Will show progress\n            writableStrategy: undefined, // (optional)\n            readableStrategy: undefined, // (optional)\n          });\n          new Response(zip).body?.pipeTo(fileStream).then(() => {\n            resolve(true);\n          });\n        } catch (err) {\n          reject(err);\n        }\n      }\n    });\n  });\n}\n","import React, { useEffect, useState } from \"react\";\nimport { api } from \"../../api/index\";\nimport Reader from \"../../components/reader/Reader\";\nimport { Article } from \"../../types/types\";\nimport Myreader from \"../myreader/Myreader\";\nimport \"./ReaderPopup.css\";\n\ntype Props = {\n  articleId: string;\n  highlights?: number[];\n  onClose?: () => void;\n};\n\nexport default function ReaderPopup({\n  articleId,\n  highlights = [],\n  onClose = undefined,\n}: Props) {\n  const [articleHtml, setArticleHtml] = useState(\"\");\n\n  useEffect(() => {\n    fetch(decodeURIComponent(articleId))\n      .then((r) => r.json())\n      .then((j) => setArticleHtml(j.content));\n  }, []);\n  return (\n    <div className=\"reader-popup-wrapper\">\n      <div className=\"blank-area\" onClick={onClose}></div>\n      <div className=\"reader-popup\">\n        {articleHtml ? <Myreader html={articleHtml}></Myreader> : \"\"}\n      </div>\n    </div>\n  );\n}\n","import { card } from \"../../api/card\";\nimport WordCard from \"../wordcard/WordCard\";\n// @ts-ignore\nimport AnkiExport from \"anki-apkg-export\";\nimport \"./CardList.css\";\nimport { bracketToBoldTag } from \"../../utils/tags\";\nimport {\n  Plugins,\n  FilesystemDirectory,\n  FilesystemEncoding,\n  Capacitor,\n} from \"@capacitor/core\";\nimport toast from \"react-hot-toast\";\nimport { useState } from \"react\";\nimport { useLocalStorage } from \"../../utils/hooks\";\nimport { Card } from \"../../types/types\";\nimport { exportApkg } from \"../../api/export\";\nimport ReaderPopup from \"../readerpopup/ReaderPopup\";\nimport { detect } from \"detect-browser\";\n\nconst { Filesystem, Share } = Plugins;\ntype CardFilterOption = \"all\" | \"exported\" | \"unexported\";\n\nexport default function CardList() {\n  const browser = detect();\n  async function exportCard() {\n    try {\n      // if (\n      //   browser?.os?.includes(\"Android\") ||\n      //   (browser?.os?.includes(\"iOS\") &&\n      //     browser.name !== \"safari\" &&\n      //     browser.name !== \"ios\")\n      // ) {\n      //   console.log(browser);\n      //   toast(\"目前导出牌组功能仅支持电脑和iOS Safari。安卓App即将推出。\");\n      //   return;\n      // }\n      const exportedCards = filterCardListByType(cardList, cardFilter);\n      await exportApkg(exportedCards, \"duck-reader.apkg\", \"duck-reader\");\n      const newCardList = cardList.map((c) => {\n        if (exportedCards.includes(c)) {\n          c.exported = true;\n        }\n        return c;\n      });\n      card.setCardList(newCardList);\n      setCardList(newCardList);\n      if (Capacitor.getPlatform() === \"web\") {\n        toast(\"牌组已下载\");\n      } else if (Capacitor.getPlatform() === \"android\") {\n        toast(\"牌组已导出至sdcard/Documents下\");\n      }\n    } catch (e) {\n      toast(\"导出失败: \" + e.message);\n    }\n  }\n  function onCardFilterSelectorChange(\n    event: React.ChangeEvent<HTMLSelectElement>\n  ) {\n    setCardFilter(event.target.value as CardFilterOption);\n  }\n  function filterCardListByType(cardList: Card[], type: CardFilterOption) {\n    if (type === \"all\") {\n      return cardList;\n    } else if (type === \"exported\") {\n      return cardList.filter((card) => card.exported);\n    } else {\n      return cardList.filter((card) => !card.exported);\n    }\n  }\n\n  function showContextPopup(id: string, index: number) {\n    setPopupArticleId(id);\n    setPopupWordIndex(index);\n  }\n\n  function hidePopup() {\n    setPopupArticleId(\"\");\n    setPopupWordIndex(-1);\n  }\n\n  const [cardFilter, setCardFilter] = useState<CardFilterOption>(\"all\");\n  const [cardList, setCardList] = useState<Card[]>(card.getCardList());\n  const cardOptions: CardFilterOption[] = [\"all\", \"exported\", \"unexported\"];\n  const [popupArticleId, setPopupArticleId] = useState(\"\");\n  const [popupWordIndex, setPopupWordIndex] = useState(-1);\n  return (\n    <>\n      <div className=\"card-list-banner\">\n        <select value={cardFilter} onChange={onCardFilterSelectorChange}>\n          <option value={cardOptions[0]}>全部</option>\n          <option value={cardOptions[1]}>已导出</option>\n          <option value={cardOptions[2]}>未导出</option>\n        </select>\n        <button onClick={exportCard}>导出Anki牌组</button>\n      </div>\n      <div className=\"card-list\">\n        {filterCardListByType(cardList, cardFilter).map((card, index) => (\n          <WordCard\n            {...card}\n            onShowContextPopup={showContextPopup}\n            defaultState=\"show\"\n            key={index}\n          ></WordCard>\n        ))}\n      </div>\n      {popupArticleId && popupWordIndex >= 0 ? (\n        <ReaderPopup\n          articleId={popupArticleId}\n          highlights={[popupWordIndex]}\n          onClose={hidePopup}\n        />\n      ) : null}\n    </>\n  );\n}\n","import CardList from \"../../components/cardlist/CardList\";\n\nexport default function CardListView() {\n  return <CardList></CardList>;\n}\n","import { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { BookItem } from \"../../types/types\";\nimport \"./Booklist.css\";\nexport default function Booklist() {\n  const [bookList, setBookList] = useState<BookItem[]>([]);\n  const history = useHistory();\n  useEffect(() => {\n    fetch(\"/calibre/bookList.json\")\n      .then((r) => r.json())\n      .then((j) => setBookList(j));\n  }, []);\n\n  const onSelectBook = (id: string) => {\n    history.push(`/book/${id}`);\n  };\n  return (\n    <div className=\"booklist\">\n      {bookList.map((book) => (\n        <div\n          className=\"book\"\n          key={book.id}\n          onClick={() => {\n            onSelectBook(book.id);\n          }}\n        >\n          <img src={book.coverUrl} />\n        </div>\n      ))}\n    </div>\n  );\n}\n","import { useHistory } from \"react-router-dom\";\nimport \"./HomeBanner.css\";\nimport FileSaver, { saveAs } from \"file-saver\";\n\nexport default function HomeBanner() {\n  const history = useHistory();\n  async function navigateToCardList() {\n    history.push(\"/cardlist\");\n  }\n  return (\n    <div className=\"home-banner\">\n      <span className=\"title\">划词网页版</span>\n      <div className=\"card-list-button\" onClick={navigateToCardList}>\n        卡片列表\n      </div>\n    </div>\n  );\n}\n","import ArticleList from \"../../components/articlelist/ArticleList\";\nimport Booklist from \"../../components/booklist/Booklist\";\nimport HomeBanner from \"../../components/homebanner/HomeBanner\";\nimport \"./MainView.css\";\n\nexport default function MainView() {\n  return (\n    <div className=\"home-view\">\n      <HomeBanner></HomeBanner>\n      <Booklist></Booklist>\n    </div>\n  );\n}\n","import React, { useCallback, useState } from \"react\";\nimport { Toaster } from \"react-hot-toast\";\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport \"./App.css\";\nimport ArticleList from \"./components/articlelist/ArticleList\";\nimport Myreader, {\n  Highlight,\n  WordSelectionEvent,\n} from \"./components/myreader/Myreader\";\nimport Myreaderwithdictionary from \"./components/myreaderwithdictionary/Myreaderwithdictionary\";\nimport CardListView from \"./views/cardlist/CardListView\";\nimport MainView from \"./views/main/MainView\";\nimport ReaderView from \"./views/reader/ReaderView\";\n\nfunction App() {\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n\n  const onWordSelection = useCallback((event: WordSelectionEvent) => {\n    setHighlights((highlights) => {\n      return highlights.concat([\n        {\n          start: event.word.positions[0],\n          end: event.word.positions[0] + 1,\n          type: \"word\",\n        },\n      ]);\n    });\n  }, []);\n\n  return (\n    <>\n      <Router>\n        <Switch>\n          <Route path=\"/\" exact>\n            <MainView></MainView>\n          </Route>\n          <Route path=\"/book/:id\">\n            <ArticleList></ArticleList>\n          </Route>\n          <Route path=\"/article/:id\">\n            <Myreaderwithdictionary></Myreaderwithdictionary>\n          </Route>\n          <Route path=\"/cardlist\">\n            <CardListView></CardListView>\n          </Route>\n        </Switch>\n      </Router>\n      <Toaster />\n    </>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}