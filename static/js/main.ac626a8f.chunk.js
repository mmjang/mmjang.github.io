(this["webpackJsonpduck-ts"]=this["webpackJsonpduck-ts"]||[]).push([[0],{138:function(e,t,n){},139:function(e,t,n){},141:function(e,t,n){},143:function(e,t,n){},158:function(e,t){},160:function(e,t){},171:function(e,t){},173:function(e,t){},198:function(e,t){},200:function(e,t){},201:function(e,t){},206:function(e,t){},208:function(e,t){},227:function(e,t){},239:function(e,t){},242:function(e,t){},245:function(e,t,n){},246:function(e,t,n){},247:function(e,t,n){},248:function(e,t,n){},249:function(e,t,n){},250:function(e,t,n){},251:function(e,t,n){},256:function(e,t,n){},257:function(e,t,n){},258:function(e,t,n){"use strict";n.r(t);var c,r=n(1),a=n.n(r),i=n(128),s=n.n(i),o=(n(138),n(22)),u=n(31),l=n(7),d=(n(139),n(3)),f=n.n(d),j=n(16),h=n(6),p=n(5),b=n(25),O="card_list_key",v=JSON.parse(localStorage.getItem(O)||"[]"),x=Object(b.a)(v);try{for(x.s();!(c=x.n()).done;){var m=c.value;void 0===m.exported&&(m.exported=!1)}}catch(be){x.e(be)}finally{x.f()}function g(){localStorage.setItem(O,JSON.stringify(v,null,2))}var w,k=function(){return v},y=function(e){v=e,g()},N=function(e){v.push(e),g()};function S(e){return Object.entries(e).filter((function(e){var t=Object(h.a)(e,2);t[0];return t[1]})).map((function(e){var t=Object(h.a)(e,2),n=t[0];t[1];return n})).join(" ")}function C(e){return e.replace(/\[\[(.+?)\]\]/g,"<b>$1</b>")}function L(e){return e.replace(/\S/g,"*")}function I(e){return e.replace(/<b>(.+?)<\/b>/g,(function(e){return L(arguments.length<=1?void 0:arguments[1])}))}!function(e){e[e.WORD=0]="WORD",e[e.BLANK=1]="BLANK",e[e.SYMBOL=2]="SYMBOL",e[e.EOL=3]="EOL"}(w||(w={}));n(141);var _=n.p+"static/media/link.00ac3d86.svg",F=n(0);function R(e){e.defaultState,e.id,e.originalWord;var t=e.sentence,n=e.articleId,c=e.wordTileIndex,a=e.dictResult,i=(e.addTime,e.exported),s=e.onShowContextPopup,o=Object(r.useState)("hide"),u=Object(h.a)(o,2),l=u[0],d=u[1];function f(){d("hide"===l?"show":"hide")}var j=S({"word-card":!0,exported:Boolean(i)});return"show"===l?Object(F.jsxs)("div",{className:j,onClick:f,children:[Object(F.jsxs)("h3",{children:[Object(F.jsx)("img",{src:_,onClick:function(e){e.stopPropagation(),s(n,c)}})," ",a.headword]}),Object(F.jsx)("p",{dangerouslySetInnerHTML:{__html:a.definition}}),Object(F.jsx)("p",{dangerouslySetInnerHTML:{__html:C(t)}})]}):Object(F.jsxs)("div",{className:j,onClick:f,children:[Object(F.jsx)("h3",{children:L(a.headword)}),Object(F.jsx)("p",{dangerouslySetInnerHTML:{__html:I(a.definition)}}),Object(F.jsx)("p",{dangerouslySetInnerHTML:{__html:I(C(t))}})]})}n(143);var W=n(19),D=n(130),P=n.n(D),T=n(131),A=W.c.Filesystem;W.c.Share;function B(e,t){return E.apply(this,arguments)}function E(){return(E=Object(p.a)(f.a.mark((function e(t,n){var c,r,a,i,s,o=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=o.length>2&&void 0!==o[2]?o[2]:"duck-reader",r=new P.a(c),a=Object(b.a)(t);try{for(a.s();!(i=a.n()).done;)s=i.value,r.addCard("<h3>".concat(s.dictResult.headword,"</h3>\n         <p>").concat(C(s.sentence),"</p>\n        "),"\n         <p>".concat(s.dictResult.phonetics,"</p>\n         <p>").concat(s.dictResult.definition,"</p>\n        "))}catch(be){a.e(be)}finally{a.f()}return e.abrupt("return",new Promise((function(e,t){r.save().then((function(c){if("android"===W.a.getPlatform()){var r=new FileReader;r.onloadend=Object(p.a)(f.a.mark((function c(){var a,i;return f.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return a=r.result,c.prev=1,c.next=4,A.writeFile({path:n,data:a,directory:W.b.Documents});case 4:i=c.sent,e(i),c.next=11;break;case 8:c.prev=8,c.t0=c.catch(1),t(c.t0);case 11:case"end":return c.stop()}}),c,null,[[1,8]])}))),r.readAsDataURL(c)}else try{Object(T.saveAs)(c,n),e(!0)}catch(be){t(be)}}))})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=function(e){return Object(p.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/data/article/".concat(e,".json")).then((function(e){return e.json()}));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))()};n(245);function H(e){var t=e.id,n=e.text,c=e.selected,r=e.highlighted,a=e.onClick,i=e.tileRefFunc;return Object(F.jsx)("span",{onClick:function(e){e.stopPropagation(),a(t)},className:S({"word-tile":!0,selected:c,highlighted:r}),ref:i,children:n})}var U,J,K=n(133),Y={init:function(){return Object(p.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(U){e.next=4;break}return e.next=3,fetch("https://cdn.jsdelivr.net/gh/mmjang/dict_hub@main/hub/forms.map.json").then((function(e){return e.json()}));case 3:U=e.sent;case 4:case"end":return e.stop()}}),e)})))()},getBaseForms:function(e){return Object(p.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y.init();case 2:return n=U[e.toLowerCase()],t.abrupt("return",n||[]);case 4:case"end":return t.stop()}}),t)})))()}},$="https://cdn.jsdelivr.net/gh/mmjang/dict_hub@main";function z(e){return e.replace(/\r|\t|\n/g,"").replace(/^<span.+?>(.*?)<\/span>$/,"$1").trim()}function Z(e){if(e.length<=2)return"".concat($,"/hub/collins/").concat(e,".json");var t=e.slice(0,2);return"".concat($,"/hub/collins/_").concat(t,"/").concat(e,".json")}function V(e){return q.apply(this,arguments)}function q(){return(q=Object(p.a)(f.a.mark((function e(t){var n,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.getBaseForms(t.toLowerCase());case 2:return n=e.sent,c=[t.toLowerCase()].concat(Object(K.a)(n)).filter((function(e){return J.has(e)})),e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G={search:function(e){var t=this;return Object(p.a)(f.a.mark((function n(){var c,r,a,i,s,o,u,l;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.init();case 2:if(J){n.next=4;break}throw"\u67ef\u6797\u65af\u8fd8\u672a\u521d\u59cb\u5316";case 4:return c=[],n.t0=Promise,n.next=8,V(e);case 8:return n.t1=n.sent.map((function(e){return fetch(Z(e)).then((function(e){return e.json()}))})),n.next=11,n.t0.all.call(n.t0,n.t1);case 11:r=n.sent,a=Object(b.a)(r);try{for(a.s();!(i=a.n()).done;){s=i.value,o=Object(b.a)(s);try{for(o.s();!(u=o.n()).done;)l=u.value,c.push(l)}catch(be){o.e(be)}finally{o.f()}}}catch(be){a.e(be)}finally{a.f()}return n.abrupt("return",c.map((function(e){return{headword:e.phrase?e.phrase:e.hwd,phonetics:e.phonetics,shortDefinition:z(e.def_cn),definition:(t=e,z(t.def_cn)+" "+z(t.def_en))};var t})));case 15:case"end":return n.stop()}}),n)})))()},init:function(){return Object(p.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.init();case 2:if(J){e.next=8;break}return e.t0=Set,e.next=6,fetch($+"/hub/collins.list.json").then((function(e){return e.json()}));case 6:e.t1=e.sent,J=new e.t0(e.t1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))()}},Q=(n(246),n.p+"static/media/add.9074dc48.svg");function X(e){var t=e.headword,n=(e.phonetics,e.definition),c=e.onAdd;return Object(F.jsxs)("div",{className:"definition",children:[Object(F.jsxs)("div",{className:"hwd-row",children:[Object(F.jsx)("img",{src:Q,onClick:c}),Object(F.jsx)("b",{children:t})]}),Object(F.jsx)("p",{dangerouslySetInnerHTML:{__html:n}})]})}n(247);var ee=n.p+"static/media/arrow-up.1ba202ef.svg",te=n.p+"static/media/arrow-down.200220c5.svg",ne=n.p+"static/media/close.53c9f4b6.svg",ce=n.p+"static/media/loading.2ce5c7c5.gif";function re(e){var t=e.word,n=e.sentence,c=void 0===n?"":n,a=e.articleId,i=e.wordIndex,s=e.onClose;console.log("rerender");var u=Object(r.useState)([]),l=Object(h.a)(u,2),d=l[0],b=l[1],O=Object(r.useState)("compact"),v=Object(h.a)(O,2),x=v[0],m=v[1],g=Object(r.useState)(!0),w=Object(h.a)(g,2),k=w[0],y=w[1],S=Object(r.useState)(""),C=Object(h.a)(S,2),L=C[0],I=C[1];Object(r.useEffect)((function(){function e(){return(e=Object(p.a)(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y(!0),I(""),e.next=5,G.search(t);case 5:n=e.sent,b(n),0===n.length&&I("\u6ca1\u67e5\u5230\u8fd9\u4e2a\u8bcd."),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),I("\u7f51\u7edc\u9519\u8bef.");case 13:return e.prev=13,y(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,10,13,16]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]);var _=Object(F.jsxs)("div",{className:"icon-row",onClick:function(){return m("full"===x?"compact":"full")},children:[Object(F.jsx)("img",{src:"full"===x?te:ee,className:"expand-icon"}),Object(F.jsx)("img",{src:ne,className:"close-icon",onClick:s})]});return k?Object(F.jsxs)("div",{className:"dictionary",children:[_,Object(F.jsx)("div",{className:"loading",children:Object(F.jsx)("img",{src:ce})})]}):"full"===x?Object(F.jsxs)("div",{className:"dictionary",children:[_,Object(F.jsx)("div",{className:"message",children:L}),d.map((function(e,n){return Object(F.jsx)("div",{className:"definition-wrapper",children:Object(F.jsx)(X,Object(j.a)(Object(j.a)({},e),{},{onAdd:function(){return n=e,N({id:Date.now().toString(),originalWord:t,sentence:c,articleId:a,wordTileIndex:i,dictResult:n,addTime:Date.now()}),void o.b.success("\u6dfb\u52a0\u6210\u529f");var n}}))},n)}))]}):Object(F.jsxs)("div",{className:"dictionary compact",children:[_,Object(F.jsx)("div",{className:"message",children:L}),d.map((function(e,t){return Object(F.jsx)("span",{className:"tag",children:e.shortDefinition},t)}))]})}n(248);function ae(e){var t=e.title,n=void 0===t?"":t,c=e.content,a=void 0===c?[]:c,i=e.articleId,s=e.highlights,o=void 0===s?[]:s,u=e.selectable,l=void 0===u||u,d=(e.scrollToHighlights,Object(r.useState)(-1)),j=Object(h.a)(d,2),b=j[0],O=j[1];function v(e){return x.apply(this,arguments)}function x(){return(x=Object(p.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("word select: ",t),k[t].type===w.WORD&&l&&O(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){var t=e.word;return e.type===w.EOL||t.endsWith("?")||t.endsWith(".")||t.endsWith("!")||t.endsWith("...")||t.endsWith('?"')||t.endsWith('!"')||t.endsWith('."')}Object(r.useEffect)((function(){if(o.length>0){var e=o[0];e<y.current.length&&y.current[e].scrollIntoView()}}),[o]);var g=0,k=[],y=Object(r.useRef)([]);function N(e){return function(e){for(var t=/^[A-Za-z-]+/,n=/^([^A-Za-z- ])+/,c=/^\s+/,r=[];e;){var a=void 0;(a=e.match(t))?r.push({word:a[0],type:w.WORD}):(a=e.match(c))?r.push({word:a[0],type:w.BLANK}):(a=e.match(n))&&r.push({word:a[0],type:w.SYMBOL}),a&&(e=e.slice(a[0].length))}return r}(e).concat({type:w.EOL,word:""}).map((function(e,t){var n=g++;return k.push(e),Object(F.jsx)(H,{id:n,text:e.word,selected:b===n,onClick:v,highlighted:o.includes(n),tileRefFunc:function(e){y.current[n]=e}},n)}))}return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("div",{className:"reader",onClick:function(){O(-1)},children:[Object(F.jsx)("h3",{children:N(n)}),null===a||void 0===a?void 0:a.map((function(e,t){return Object(F.jsx)("p",{children:N(e.content)},t)}))]}),b>=0?Object(F.jsx)(re,{word:k[b].word,sentence:function(e){for(var t=e-1,n=e,c="[[".concat(k[e].word,"]]");t>=0&&e-t<50&&!m(k[t]);)c=k[t].word+c,t--;for(;n<k.length&&n-e<50&&!m(k[n]);)n++,c+=k[n].word;return c}(b),articleId:i,wordIndex:b,onClose:function(){return O(-1)}}):null]})}n(249);function ie(e){var t=e.articleId,n=e.highlights,c=void 0===n?[]:n,a=e.onClose,i=void 0===a?void 0:a,s=Object(r.useState)(),o=Object(h.a)(s,2),u=o[0],l=o[1];return Object(r.useEffect)((function(){function e(){return(e=Object(p.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=l,e.next=3,M(t);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),Object(F.jsxs)("div",{className:"reader-popup-wrapper",children:[Object(F.jsx)("div",{className:"blank-area",onClick:i}),Object(F.jsx)("div",{className:"reader-popup",children:u?Object(F.jsx)(ae,Object(j.a)(Object(j.a)({},u),{},{highlights:c,selectable:!1})):""})]})}W.c.Filesystem,W.c.Share;function se(){function e(){return(e=Object(p.a)(f.a.mark((function e(){var n,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t(d,i),e.next=4,B(n,"duck-reader.apkg","duck-reader");case 4:c=d.map((function(e){return n.includes(e)&&(e.exported=!0),e})),y(c),b(c),"web"===W.a.getPlatform()?Object(o.b)("\u724c\u7ec4\u5df2\u4e0b\u8f7d"):"android"===W.a.getPlatform()&&Object(o.b)("\u724c\u7ec4\u5df2\u5bfc\u51fa\u81f3sdcard/Documents\u4e0b"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),Object(o.b)("\u5bfc\u51fa\u5931\u8d25");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function t(e,t){return"all"===t?e:"exported"===t?e.filter((function(e){return e.exported})):e.filter((function(e){return!e.exported}))}function n(e,t){g(e),C(t)}var c=Object(r.useState)("all"),a=Object(h.a)(c,2),i=a[0],s=a[1],u=Object(r.useState)(k()),l=Object(h.a)(u,2),d=l[0],b=l[1],O=["all","exported","unexported"],v=Object(r.useState)(""),x=Object(h.a)(v,2),m=x[0],g=x[1],w=Object(r.useState)(-1),N=Object(h.a)(w,2),S=N[0],C=N[1];return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("div",{className:"card-list-banner",children:[Object(F.jsxs)("select",{value:i,onChange:function(e){s(e.target.value)},children:[Object(F.jsx)("option",{value:O[0],children:"\u5168\u90e8"}),Object(F.jsx)("option",{value:O[1],children:"\u5df2\u5bfc\u51fa"}),Object(F.jsx)("option",{value:O[2],children:"\u672a\u5bfc\u51fa"})]}),Object(F.jsx)("button",{onClick:function(){return e.apply(this,arguments)},children:"\u5bfc\u51faAnki\u724c\u7ec4"})]}),Object(F.jsx)("div",{className:"card-list",children:t(d,i).map((function(e,t){return Object(r.createElement)(R,Object(j.a)(Object(j.a)({},e),{},{onShowContextPopup:n,defaultState:"show",key:t}))}))}),m&&S>=0?Object(F.jsx)(ie,{articleId:m,highlights:[S],onClose:function(){g(""),C(-1)}}):null]})}function oe(){return Object(F.jsx)(se,{})}n(250),n(251);function ue(e){var t=e.title,n=e.imgUrl,c=e.summary,r=e.clickHandler;return Object(F.jsxs)("div",{className:"article-item",onClick:r,children:[Object(F.jsx)("div",{className:"img-wrapper",children:Object(F.jsx)("img",{src:n,className:"img"})}),Object(F.jsx)("div",{className:"title",children:t}),Object(F.jsx)("div",{className:"description",children:c})]})}function le(e){var t=e.sourceUrl,n=Object(r.useState)([]),c=Object(h.a)(n,2),a=c[0],i=c[1];Object(r.useEffect)((function(){Object(p.a)(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){return e.json()}));case 2:n=e.sent,i(n);case 4:case"end":return e.stop()}}),e)})))()}),[t]);var s=Object(l.f)();return Object(F.jsx)("div",{children:a.map((function(e){return Object(F.jsx)(ue,{title:e.title,imgUrl:e.img,summary:e.description,clickHandler:function(){return t=e.id,void s.push("/article/".concat(t));var t}},e.id)}))})}n(256);function de(){var e=Object(l.f)();function t(){return(t=Object(p.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/cardlist");case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(F.jsxs)("div",{className:"home-banner",children:[Object(F.jsx)("span",{className:"title",children:"\u5212\u8bcd\u7f51\u9875\u7248"}),Object(F.jsx)("div",{className:"card-list-button",onClick:function(){return t.apply(this,arguments)},children:"\u5361\u7247\u5217\u8868"})]})}n(257);function fe(){return Object(F.jsxs)("div",{className:"home-view",children:[Object(F.jsx)(de,{}),Object(F.jsx)(le,{sourceUrl:"/data/section/editor.json"})]})}function je(){var e=Object(l.h)(),t=(new URLSearchParams(Object(l.g)().search).get("highlights")||"").split(" ").filter((function(e){return e})).map(Number);console.log("hilights: ",t);var n=e.id,c=Object(r.useState)(),a=Object(h.a)(c,2),i=a[0],s=a[1];return Object(r.useEffect)((function(){function e(){return(e=Object(p.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,M(n);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]),Object(F.jsx)("div",{className:"App",children:i?Object(F.jsx)(ae,Object(j.a)(Object(j.a)({},i),{},{highlights:t})):""})}var he=function(){return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(u.a,{children:Object(F.jsxs)(l.c,{children:[Object(F.jsx)(l.a,{path:"/",exact:!0,children:Object(F.jsx)(fe,{})}),Object(F.jsx)(l.a,{path:"/article/:id",children:Object(F.jsx)(je,{})}),Object(F.jsx)(l.a,{path:"/cardlist",children:Object(F.jsx)(oe,{})})]})}),Object(F.jsx)(o.a,{})]})},pe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,259)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),a(e),i(e)}))};s.a.render(Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(he,{})}),document.getElementById("root")),pe()}},[[258,1,2]]]);
//# sourceMappingURL=main.ac626a8f.chunk.js.map